!function(){"use strict";let e=0;const t={setLevel(t){e=t},getLevel:()=>e,log(t,n,o,a=null){if(e>=t){const e=(new Date).toISOString(),t=a?JSON.stringify(a,null,2):"";console.log(`[${e}] [${n}] ${o} ${t}`),this.updateDebugUI(n,o,a)}},error(e,t,n=null){this.log(1,e,`ERROR: ${t}`,n)},warn(e,t,n=null){this.log(2,e,`WARNING: ${t}`,n)},info(e,t,n=null){this.log(3,e,t,n)},debug(e,t,n=null){this.log(4,e,t,n)},initializeDebugUI(){if(!document.getElementById("debugPanel")){const e=document.createElement("div");e.id="debugPanel",e.style.cssText="\n                position: fixed;\n                bottom: 0;\n                right: 0;\n                width: 300px;\n                height: 200px;\n                background: rgba(0, 0, 0, 0.8);\n                color: #fff;\n                padding: 10px;\n                font-family: monospace;\n                font-size: 12px;\n                overflow-y: auto;\n                z-index: 9999;\n            ",document.body.appendChild(e)}},updateDebugUI(e,t,n){const o=document.getElementById("debugPanel");if(o){const a=document.createElement("div");for(a.innerHTML=`[${e}] ${t}`,n&&(a.title=JSON.stringify(n,null,2)),o.appendChild(a);o.children.length>50;)o.removeChild(o.firstChild);o.scrollTop=o.scrollHeight}}};const n="https://hex-api.climartis.ch/api/getPossibleAddress",o="https://hex-api.climartis.ch/api/getHouseInfo",a="https://hex-api.climartis.ch/api/getCalculation";async function r(e){const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error, status = ${t.status}`);return await t.json()}let i=null,l=null;function c(){["buildingAge","livingArea","heatingType","heatingAge","newHeatingType","newHeatingPlace","dhw","dhwAge","newDhw","newDhwPlace"].forEach((e=>{const t=document.getElementById(e);t&&("radio"===t.type?t.checked=!1:t.value="")}))}async function s(e){try{if(t.info("Calculation","Calculating monthly payment",{params:e}),!function(e){return["buildingAge","livingArea","heatingType","heatingAge","newHeatingType"].every((n=>{const o=void 0!==e[n]&&""!==e[n];return o||t.warn("Validation",`Missing required field: ${n}`),o}))}(e))return void t.error("Calculation","Invalid calculation parameters");const n=await async function(e,t){const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`HTTP error, status = ${n.status}`);return await n.json()}(a,e);!function(e){t.info("Display","Showing calculation results",{data:e});const n={totalCost:document.getElementById("totalCost"),subsidies:document.getElementById("subsidies"),netCost:document.getElementById("netCost"),monthlyPayment:document.getElementById("monthlyPayment")};Object.entries(n).forEach((([t,n])=>{var o;n&&void 0!==e[t]&&(n.textContent=(o=e[t],new Intl.NumberFormat("de-CH",{style:"currency",currency:"CHF"}).format(o)))}))}(n)}catch(e){t.error("Calculation","Error calculating payment",{error:e})}}const d=function(e,t){let n;return function(){const o=this,a=arguments;clearTimeout(n),n=setTimeout((()=>{e.apply(o,a)}),t)}}((async function(){const e=document.getElementById("addressInput").value.trim();if(0!==e.length)try{!function(e){const t=document.getElementById("myDropdown");t.innerHTML="",e&&e.length>0?(e.forEach((e=>{const n=document.createElement("div");n.textContent=e.address,n.onclick=()=>u(e.eingangId),t.appendChild(n)})),t.classList.add("show")):t.classList.remove("show")}(await r(`${n}?address=${encodeURIComponent(e)}`)),c()}catch(e){t.error("Address","Error fetching possible addresses:",e)}}),300);async function u(e){t.info("Address","Handling address selection",{eingangId:e});try{c();const n=await r(`${o}?eingangId=${e}`);t.info("Address","Received house info",{coordinates:{dkodeE:n.dkodeE,dkodeN:n.dkodeN}}),function(e){t.info("Form","Prefilling form fields",{houseInfo:e}),Object.entries({buildingAge:"buildingAge",livingArea:"livingArea",heatingType:"heatingType",heatingAge:"heatingAge",dhw:"dhw",dhwAge:"dhwAge"}).forEach((([t,n])=>{const o=document.getElementById(t);o&&void 0!==e[n]&&(o.value=e[n])}))}(n);const a=document.querySelector('input[name="eingangId"]');if(a?a.value=e:t.error("Address","eingangId input field not found"),n.dkodeE&&n.dkodeN){const e=function(e,t){const n=(e-26e5)/1e6,o=(t-12e5)/1e6;let a=16.9023892+3.238272*o-.270978*Math.pow(n,2)-.002528*Math.pow(o,2)-.0447*Math.pow(n,2)*o-.014*Math.pow(o,3);return a=100*a/36,a}(n.dkodeE,n.dkodeN),o=function(e,t){const n=(e-26e5)/1e6,o=(t-12e5)/1e6;let a=2.6779094+4.728982*n+.791484*n*o+.1306*n*Math.pow(o,2)-.0436*Math.pow(n,3);return a=100*a/36,a}(n.dkodeE,n.dkodeN);t.info("Map","Converting coordinates",{swiss:{E:n.dkodeE,N:n.dkodeN},wgs84:{lat:e,lng:o}}),function(e,n){t.info("Map","Updating map position",{lat:e,lng:n});try{if(!i)return void t.error("Map","Map instance not found");const o={lat:parseFloat(e),lng:parseFloat(n)};if(isNaN(o.lat)||isNaN(o.lng))return void t.error("Map","Invalid coordinates",o);i.setCenter(o),i.setZoom(18),l?(l.setPosition(o),t.info("Map","Updated existing marker position")):(l=new google.maps.Marker({position:o,map:i,animation:google.maps.Animation.DROP}),t.info("Map","Created new marker"))}catch(e){t.error("Map","Error updating map",{error:e})}}(e,o)}else t.warn("Map","No coordinates found in house info")}catch(e){t.error("Address","Error fetching house info",{error:e})}}const m=new class{constructor(){this.cards=["A","B","C"]}updateProductDisplay(e,n){try{if(!e||!n)return t.warn("Product","Missing item or suffix for product display update"),!1;const o=e.heatPump;return o?(t.info("Product",`Updating product display for suffix ${n}`,{heatPump:o}),!0):(t.warn("Product","No heat pump data available"),!1)}catch(e){return t.error("Product","Error updating product display",{error:e,suffix:n}),!1}}updatePrices(e,n){try{const t=document.getElementById(`totalPrice${n}`);t&&e.totalPrice&&(t.textContent=e.totalPrice)}catch(e){t.error("Product","Error updating prices",{error:e,suffix:n})}}updateSpecs(e,n){try{e.specs&&Object.entries(e.specs).forEach((([e,t])=>{const o=document.getElementById(`${e}${n}`);o&&(o.textContent=t)}))}catch(e){t.error("Product","Error updating specs",{error:e,suffix:n})}}updateCalculationNumbers(e,n){try{["serviceFeeValue","maintenanceValue","energyManagementValue","ratInsuranceValue","interestRateValue","taxValue"].forEach((t=>{const o=document.getElementById(`${t}${n}`);o&&e[t]&&(o.textContent=e[t])}))}catch(e){t.error("Product","Error updating calculation numbers",{error:e,suffix:n})}}};const g=new class{constructor(){this.anzahlung=.1,this.years=60}getNumberFromElement(e,n=0){try{const o=document.getElementById(e);if(!o)return t.warn("Payment",`Element not found: ${e}`),n;const a=o.textContent.replace(/[^0-9.-]+/g,""),r=parseFloat(a);return isNaN(r)?n:r}catch(o){return t.error("Payment",`Error parsing value for ${e}`,{error:o}),n}}calculateProductMonthlyPayment(e){try{const n=this.getNumberFromElement(`serviceFeeValue${e}`)/100,o=this.getNumberFromElement(`maintenanceValue${e}`),a=this.getNumberFromElement(`energyManagementValue${e}`),r=this.getNumberFromElement(`ratInsuranceValue${e}`)/100,i=this.getNumberFromElement(`interestRateValue${e}`),l=this.getNumberFromElement(`taxValue${e}`)/100,c=this.getNumberFromElement(`totalPrice${e}`);t.info("Payment",`Calculation values for product ${e}`,{serviceFee:n,maintenance:o,energyManagement:a,ratInsurance:r,interestRate:i,tax:l,totalCost:c});const s=c*this.anzahlung,d=c-s,u=i>0?i/100/12:1e-9,m=this.years,g=d*(u*Math.pow(1+u,m)/(Math.pow(1+u,m)-1)),y=o+a+g*n,p=g+y,h=p+p*r,f=h*(1+l),E=Math.round(f);t.info("Payment",`Monthly payment calculation for product ${e}`,{downpayment:s,principalAfterDownPayment:d,monthlyPaymentBase:g,additionalCosts:y,totalNet:h,monthlyPayment:E});const w=document.getElementById(`moPrice${e}`);return w?w.textContent=E:t.error("Payment",`Monthly price element not found for product ${e}`),E}catch(n){return t.error("Payment",`Error calculating monthly payment for product ${e}`,{error:n}),0}}calculateAllMonthlyPayments(){try{const e={};m.cards.forEach((t=>{e[t]=this.calculateProductMonthlyPayment(t)})),t.info("Payment","Monthly payment calculations completed",e)}catch(e){t.error("Payment","Error in monthly payment calculations",{error:e})}}};function y(){t.info("System","Setting up event listeners");const e=document.getElementById("addressInput");e&&e.addEventListener("input",d);["buildingAge","livingArea","heatingType","heatingAge","newHeatingType","newHeatingPlace","dhw","dhwAge","newDhw","newDhwPlace"].forEach((e=>{const t=document.getElementById(e);t&&t.addEventListener("change",(()=>{s(p())}))}));document.querySelectorAll(".payment-tab").forEach((e=>{e.addEventListener("click",(()=>function(e){const t=document.querySelectorAll(".payment-tab");t.forEach((e=>{e.classList.remove("active")})),e.classList.add("active");const n=e.getAttribute("data-payment");document.getElementById("chosenPayment").value=n,s(p())}(e)))}))}function p(){return{buildingAge:document.getElementById("buildingAge").value,livingArea:document.getElementById("livingArea").value,heatingType:document.getElementById("heatingType").value,heatingAge:document.getElementById("heatingAge").value,newHeatingType:document.getElementById("newHeatingType").value,newHeatingPlace:document.getElementById("newHeatingPlace").value,dhw:document.getElementById("dhw").value,dhwAge:document.getElementById("dhwAge").value,newDhw:document.getElementById("newDhw").value,newDhwPlace:document.getElementById("newDhwPlace").value}}t.setLevel(1),console.log("initialized"),window.initMap=function(){t.info("Map","Initializing Google Map");try{const e={lat:46.8182,lng:8.2275},n={zoom:8,center:e,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0},o=document.getElementById("map");if(!o)return void t.error("Map","Map element not found");i=new google.maps.Map(o,n),t.info("Map","Map initialized successfully",{defaultLocation:e})}catch(e){t.error("Map","Error initializing map",{error:e})}},window.handleAddressSelection=u,window.displayCalculationResults=function(e){t.info("Display","Displaying calculation results",{data:e});try{document.getElementById("totalCosts").textContent=e.totalCosts,document.getElementById("totalCostsWithoutSubvention").textContent=e.totalCostsWithoutSubvention,document.getElementById("subventionFederal").textContent=e.subventionFederal,document.getElementById("subventionCanton").textContent=e.subventionCanton,document.getElementById("subventionMunicipality").textContent=e.subventionMunicipality,document.getElementById("subventionTotal").textContent=e.subventionTotal,document.getElementById("financingAmount").textContent=e.financingAmount,document.getElementById("anzahlung").textContent=e.anzahlung,function(e){const t=document.getElementById("monthlyPayment"),n=document.getElementById("monthlyInterest");t&&e.monthlyPayment&&(t.textContent=e.monthlyPayment.toFixed(2));n&&e.monthlyInterest&&(n.textContent=e.monthlyInterest.toFixed(2))}(e),t.info("Display","Calculation results displayed successfully")}catch(e){t.error("Display","Error displaying calculation results",{error:e})}},window.calculateMonthlyPayment=g.calculateProductMonthlyPayment.bind(g),document.addEventListener("DOMContentLoaded",(()=>{t.info("System","Initializing application"),y(),t.getLevel()>0&&t.initializeDebugUI(),function(){const e=document.getElementById("newHeatingPlace"),t=document.getElementById("dhp");e&&t&&(t.style.display="dhp"===e.value?"block":"none")}()}))}();
//# sourceMappingURL=bundle.min.js.map
